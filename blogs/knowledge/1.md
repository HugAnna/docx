---
title: js并发请求
date: 2024-03-25
categories:
 - 杂项
tags:
 - 杂项
sidebar: 'auto'
---
---
theme: channing-cyan
---
``` js
       // urls 请求接口 maxNum最大并发数
      concurRequest(urls,maxNum){
        if(urls.length===0) return Promise.resolve([]);
        return new Promise((resolve) => {
        let index = 0; //指向下一次请求的url
        const result = [];
        let count = 0 ;// 当前完成数
         async function _request() {
          const i = index;
          const url = urls[index]
          index++;
          try {
               const resp =  await fetch(url)
               result[i] = resp
          } catch (error) {
              result[i] = error
          }finally {
            count++;
            if (count === urls.length) {
              resolve(result)
            }
            if (index < urls.length) {
              _request()
            }
          }
     
        }
        for (let i = 0; i <Math.min(urls.length,maxNum) ; i++) {
               _request()
        }

      })
    },
```
