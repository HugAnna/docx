---
title: 16：diff算法(创建虚拟dom和数据更新)
date: 2024-03-05  
tags:
 - vue核心源码
categories:
 - vue核心源码
sidebar: 'auto'
---  
vue数据更新时,diff算法是创建两个vnode,newVnode和oldVnode通过对比,将不同的地方进行更新,实现最小量的更新。  
**index.js**
入口文件创建测试数据。
``` js
   //创建vnode
    let vm1 = new Vue({data:{name:'张三'}})
    let render1 = compileToFunction(`<ul>
     <li>a</li>
     <li>b</li>
     <li>c</li>
    </ul>`)
    let vnode1 = render1.call(vm1)
     document.body.appendChild(createELm(vnode1))
   //数据更新
     let vm2 = new Vue({data:{name:'李四'}})
     let render2 = compileToFunction(`<ul>
     <li>a</li>
     <li>b</li>
     <li>c</li>
     <li>d</li>
    </ul>`)
     let vnode2 = render2.call(vm2)
     //patch 比对
      setTimeout(()=>{
        patch(vnode1,vnode2)
      },2000)
```